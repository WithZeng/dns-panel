{% extends "base.html" %}
{% block title %}å®šæ—¶ä»»åŠ¡ Â· {{ instance.name }}{% endblock %}
{% block content %}
<div class="max-w-3xl mx-auto">
    <div class="mb-6">
        <a href="{{ url_for('main.instance_detail', id=instance.id) }}"
            class="text-sm text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-slate-200 transition">&larr;
            è¿”å› {{ instance.name }}</a>
    </div>

    <div
        class="bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 p-6 mb-6">
        <h1 class="text-xl font-bold text-slate-900 dark:text-white mb-4">â° æ·»åŠ å®šæ—¶ä»»åŠ¡</h1>

        <form method="POST" class="space-y-4">
            <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
                <div>
                    <label class="block text-sm font-medium text-slate-600 dark:text-slate-400 mb-1">æ“ä½œ</label>
                    <select name="action"
                        class="w-full bg-slate-50 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-xl px-4 py-3 text-slate-700 dark:text-slate-200">
                        <option value="stop">ğŸ”´ åœæ­¢</option>
                        <option value="start">ğŸŸ¢ å¯åŠ¨</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-600 dark:text-slate-400 mb-1">æ—¶é—´</label>
                    <div class="flex gap-2">
                        <select name="hour"
                            class="flex-1 bg-slate-50 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-xl px-3 py-3 text-slate-700 dark:text-slate-200">
                            {% for h in range(24) %}
                            <option value="{{ h }}">{{ '%02d'|format(h) }}</option>
                            {% endfor %}
                        </select>
                        <span class="flex items-center text-slate-400 font-bold">:</span>
                        <select name="minute"
                            class="flex-1 bg-slate-50 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-xl px-3 py-3 text-slate-700 dark:text-slate-200">
                            {% for m in range(0, 60, 5) %}
                            <option value="{{ m }}">{{ '%02d'|format(m) }}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-600 dark:text-slate-400 mb-1">æ—¥æœŸ
                        <span class="text-slate-400 font-normal">(* = æ¯å¤©)</span></label>
                    <input name="days_of_week" type="text" value="*" placeholder="* æˆ– 1,2,3,4,5"
                        class="w-full bg-slate-50 dark:bg-slate-700 border border-slate-200 dark:border-slate-600 rounded-xl px-4 py-3 text-slate-700 dark:text-slate-200">
                    <p class="text-xs text-slate-400 mt-1">1=å‘¨ä¸€ â€¦ 7=å‘¨æ—¥ï¼Œé€—å·åˆ†éš”</p>
                </div>
            </div>
            <button type="submit"
                class="w-full py-3 bg-gradient-to-r from-slate-800 to-slate-900 dark:from-blue-600 dark:to-blue-700 text-white rounded-xl font-medium hover:shadow-lg transition-all">
                â• æ·»åŠ å®šæ—¶ä»»åŠ¡
            </button>
        </form>
    </div>

    <!-- Existing schedules -->
    {% if schedules %}
    <div
        class="bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden">
        <div class="px-5 py-4 border-b border-slate-100 dark:border-slate-700">
            <h2 class="text-lg font-bold text-slate-900 dark:text-white">å·²æœ‰ä»»åŠ¡</h2>
        </div>
        <div class="divide-y divide-slate-100 dark:divide-slate-700">
            {% for task in schedules %}
            <div
                class="flex items-center justify-between px-5 py-4 hover:bg-slate-50 dark:hover:bg-slate-700/30 transition">
                <div class="flex items-center gap-3">
                    <span class="text-2xl">{{ 'ğŸŸ¢' if task.action == 'start' else 'ğŸ”´' }}</span>
                    <div>
                        <div class="font-semibold text-slate-800 dark:text-white">
                            {{ '%02d:%02d'|format(task.hour, task.minute) }}
                            <span class="text-sm font-normal text-slate-500 dark:text-slate-400 ml-1">
                                {{ 'å¯åŠ¨' if task.action == 'start' else 'åœæ­¢' }}
                            </span>
                        </div>
                        <div class="text-xs text-slate-400 dark:text-slate-500">
                            {% if task.days_of_week == '*' %}
                            æ¯å¤©
                            {% else %}
                            {% set day_names = {'1':'ä¸€','2':'äºŒ','3':'ä¸‰','4':'å››','5':'äº”','6':'å…­','7':'æ—¥'} %}
                            å‘¨{% for d in task.days_of_week.split(',') %}{{ day_names.get(d.strip(), d.strip()) }}{% if
                            not loop.last %}/{% endif %}{% endfor %}
                            {% endif %}
                            Â· {% if task.enabled %}<span class="text-emerald-500">å·²å¯ç”¨</span>{% else %}<span
                                class="text-slate-400">å·²ç¦ç”¨</span>{% endif %}
                        </div>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <form method="POST" action="{{ url_for('main.toggle_schedule', id=task.id) }}" class="inline">
                        <button type="submit"
                            class="rounded-lg border border-slate-200 dark:border-slate-600 px-3 py-1.5 text-xs {{ 'text-amber-600 bg-amber-50 dark:bg-amber-900/20' if task.enabled else 'text-emerald-600 bg-emerald-50 dark:bg-emerald-900/20' }} hover:opacity-80 transition">
                            {{ 'ç¦ç”¨' if task.enabled else 'å¯ç”¨' }}
                        </button>
                    </form>
                    <form method="POST" action="{{ url_for('main.delete_schedule', id=task.id) }}" class="inline"
                        onsubmit="return confirm('ç¡®è®¤åˆ é™¤ï¼Ÿ')">
                        <button type="submit"
                            class="rounded-lg border border-red-200 dark:border-red-700 px-3 py-1.5 text-xs text-red-600 bg-red-50 dark:bg-red-900/20 hover:opacity-80 transition">
                            åˆ é™¤
                        </button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% else %}
    <div
        class="text-center py-12 bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700">
        <p class="text-3xl mb-2">â°</p>
        <p class="text-slate-400">æš‚æ— å®šæ—¶ä»»åŠ¡ï¼Œä½¿ç”¨ä¸Šé¢çš„è¡¨å•æ·»åŠ ã€‚</p>
    </div>
    {% endif %}
</div>
{% endblock %}